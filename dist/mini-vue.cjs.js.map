{"version":3,"file":"mini-vue.cjs.js","sources":["../src/shared/index.ts","../src/runtime-core/src/componentPublicInstance.ts","../src/runtime-core/src/component.ts","../src/runtime-core/src/render.ts","../src/runtime-core/src/vnode.ts","../src/runtime-core/src/createApp.ts","../src/runtime-core/src/h.ts"],"sourcesContent":["export const extend = Object.assign;\n\nexport const isObject = (val) => {\n  return val != null && typeof val == \"object\";\n};\n\nexport const isSame = (val, newVal) => {\n  return Object.is(val, newVal);\n};\n","const map = {\r\n  $el: (i) => i.vnode.el,\r\n};\r\nexport const publicInstanceHandlers = {\r\n  get({ _: instance }, key) {\r\n    console.log(\"@\", instance);\r\n\r\n    // setup\r\n    const { setupState } = instance;\r\n    if (key in setupState) {\r\n      return setupState[key];\r\n    }\r\n\r\n    // type\r\n    // if (key == \"$el\") {\r\n    //   return instance.vnode.el;\r\n    // }\r\n    const getter = map[key];\r\n    if (getter) return getter(instance);\r\n  },\r\n  set(target, key, val) {\r\n    return true;\r\n  },\r\n};\r\n","import { publicInstanceHandlers } from \"./componentPublicInstance\";\n\nexport function createComponentInstance(vnode) {\n  // proxy--组件代理对象\n  const component = {\n    vnode,\n    type: vnode.type,\n    setupState: {},\n  };\n\n  return component;\n}\n\nexport function setupComponent(instance) {\n  // TODO\n  // initProps()\n  // initSlots()\n\n  setupStatefulComponent(instance);\n}\n\n// instance添加状态(setupRes、render)\nfunction setupStatefulComponent(instance) {\n  // instance: {vnode, xxx} vnode: {type(编写的组件), props?, children}\n  const component = instance.type;\n  const { setup } = component;\n\n  // handle setup\n  if (setup) {\n    const setupRes = setup();\n    handleSetupRes(instance, setupRes);\n  }\n\n  // handle proxy\n  instance.proxy = new Proxy({ _: instance }, publicInstanceHandlers);\n}\n\nfunction handleSetupRes(instance, setupRes: any) {\n  // 1. return 函数\n  // 2. return 值\n\n  if (typeof setupRes == \"object\") {\n    instance.setupState = setupRes;\n  }\n  finishComponentSetup(instance);\n}\nfunction finishComponentSetup(instance) {\n  const component = instance.type;\n  if (component.render) {\n    instance.render = component.render;\n  }\n}\n","import { isObject } from \"../../shared\";\nimport { createComponentInstance, setupComponent } from \"./component\";\n\nexport function render(vnode, container) {\n  // invoke patch\n  patch(vnode, container);\n}\n\n/**\n * 递归处理虚拟节点树, 递归终点是Element\n * @param vnode 虚拟节点\n * @param container 根容器Element\n */\nfunction patch(vnode, container) {\n  // debugger;\n  // check node type, assert to be component\n  if (isObject(vnode.type)) {\n    processComponent(vnode, container);\n  } else {\n    processElement(vnode, container);\n  }\n}\n\n// 处理component组件\nfunction processComponent(vnode, container) {\n  // init\n  mountComponent(vnode, container);\n\n  // update\n  updateComponent(vnode);\n}\nfunction mountComponent(vnode: any, container) {\n  const instance = createComponentInstance(vnode);\n  setupComponent(instance);\n  setupRenderEffects(instance, vnode, container);\n}\n\nfunction setupRenderEffects(instance, vnode, container) {\n  const { proxy } = instance;\n  // call 是 JavaScript 中的一个方法，用于调用函数并指定函数内部的 this 上下文, 这里调用render同时指定上下文this为proxy, 而不是instance\n  const subTree = instance.render.call(proxy);\n\n  // vnode -> element -> mount(element)\n  // 进入递归\n  patch(subTree, container);\n\n  // 递归完毕\n  vnode.el = subTree.el;\n}\n\nfunction updateComponent(vnode: any) {}\n\n// 处理element节点\nfunction processElement(vnode: any, container: any) {\n  mountElement(vnode, container);\n}\nfunction mountElement(vnode: any, container: any) {\n  const { type, props, children } = vnode;\n  // 1. el & add 虚拟节点的el属性\n  const element = (vnode.el = document.createElement(type));\n\n  // 2. add children\n  if (typeof children == \"string\") element.textContent = children;\n  else if (Array.isArray(children)) {\n    mountChildren(vnode, element);\n  }\n\n  // 3. add props\n  for (const key in props) {\n    const val = props[key];\n    element.setAttribute(key, val);\n  }\n  container.append(element);\n}\n\nfunction mountChildren(vnode: any, container: any) {\n  vnode.children.forEach((child) => {\n    patch(child, container);\n  });\n}\n","export function createVNode(type, props?, children?) {\n  const vnode = { type, props, children };\n\n  return vnode;\n}\n","import { render } from \"./render\";\nimport { createVNode } from \"./vnode\";\n\nexport function createApp(rootComponent) {\n  return {\n    mount(rootContainer) {\n      // 1. component -> vnode\n      // 所有操作都是基于vnode\n      // vnode有component和element两种类型\n      const vnode = createVNode(rootComponent);\n\n      // 2. invoke render\n      render(vnode, rootContainer);\n    },\n  };\n}\n","import { createVNode } from \"./vnode\";\r\nexport const h = (\r\n  type: any,\r\n  props: any = null,\r\n  children: string | Array<any> = []\r\n) => {\r\n  return createVNode(type, props, children);\r\n};\r\n"],"names":[],"mappings":";;AAEO,MAAM,QAAQ,GAAG,CAAC,GAAG,KAAI;IAC9B,OAAO,GAAG,IAAI,IAAI,IAAI,OAAO,GAAG,IAAI,QAAQ,CAAC;AAC/C,CAAC;;ACJD,MAAM,GAAG,GAAG;IACV,GAAG,EAAE,CAAC,CAAC,KAAK,CAAC,CAAC,KAAK,CAAC,EAAE;CACvB,CAAC;AACK,MAAM,sBAAsB,GAAG;AACpC,IAAA,GAAG,CAAC,EAAE,CAAC,EAAE,QAAQ,EAAE,EAAE,GAAG,EAAA;AACtB,QAAA,OAAO,CAAC,GAAG,CAAC,GAAG,EAAE,QAAQ,CAAC,CAAC;;AAG3B,QAAA,MAAM,EAAE,UAAU,EAAE,GAAG,QAAQ,CAAC;AAChC,QAAA,IAAI,GAAG,IAAI,UAAU,EAAE;AACrB,YAAA,OAAO,UAAU,CAAC,GAAG,CAAC,CAAC;SACxB;;;;;AAMD,QAAA,MAAM,MAAM,GAAG,GAAG,CAAC,GAAG,CAAC,CAAC;AACxB,QAAA,IAAI,MAAM;AAAE,YAAA,OAAO,MAAM,CAAC,QAAQ,CAAC,CAAC;KACrC;AACD,IAAA,GAAG,CAAC,MAAM,EAAE,GAAG,EAAE,GAAG,EAAA;AAClB,QAAA,OAAO,IAAI,CAAC;KACb;CACF;;ACrBK,SAAU,uBAAuB,CAAC,KAAK,EAAA;;AAE3C,IAAA,MAAM,SAAS,GAAG;QAChB,KAAK;QACL,IAAI,EAAE,KAAK,CAAC,IAAI;AAChB,QAAA,UAAU,EAAE,EAAE;KACf,CAAC;AAEF,IAAA,OAAO,SAAS,CAAC;AACnB,CAAC;AAEK,SAAU,cAAc,CAAC,QAAQ,EAAA;;;;IAKrC,sBAAsB,CAAC,QAAQ,CAAC,CAAC;AACnC,CAAC;AAED;AACA,SAAS,sBAAsB,CAAC,QAAQ,EAAA;;AAEtC,IAAA,MAAM,SAAS,GAAG,QAAQ,CAAC,IAAI,CAAC;AAChC,IAAA,MAAM,EAAE,KAAK,EAAE,GAAG,SAAS,CAAC;;IAG5B,IAAI,KAAK,EAAE;AACT,QAAA,MAAM,QAAQ,GAAG,KAAK,EAAE,CAAC;AACzB,QAAA,cAAc,CAAC,QAAQ,EAAE,QAAQ,CAAC,CAAC;KACpC;;AAGD,IAAA,QAAQ,CAAC,KAAK,GAAG,IAAI,KAAK,CAAC,EAAE,CAAC,EAAE,QAAQ,EAAE,EAAE,sBAAsB,CAAC,CAAC;AACtE,CAAC;AAED,SAAS,cAAc,CAAC,QAAQ,EAAE,QAAa,EAAA;;;AAI7C,IAAA,IAAI,OAAO,QAAQ,IAAI,QAAQ,EAAE;AAC/B,QAAA,QAAQ,CAAC,UAAU,GAAG,QAAQ,CAAC;KAChC;IACD,oBAAoB,CAAC,QAAQ,CAAC,CAAC;AACjC,CAAC;AACD,SAAS,oBAAoB,CAAC,QAAQ,EAAA;AACpC,IAAA,MAAM,SAAS,GAAG,QAAQ,CAAC,IAAI,CAAC;AAChC,IAAA,IAAI,SAAS,CAAC,MAAM,EAAE;AACpB,QAAA,QAAQ,CAAC,MAAM,GAAG,SAAS,CAAC,MAAM,CAAC;KACpC;AACH;;AChDgB,SAAA,MAAM,CAAC,KAAK,EAAE,SAAS,EAAA;;AAErC,IAAA,KAAK,CAAC,KAAK,EAAE,SAAS,CAAC,CAAC;AAC1B,CAAC;AAED;;;;AAIG;AACH,SAAS,KAAK,CAAC,KAAK,EAAE,SAAS,EAAA;;;AAG7B,IAAA,IAAI,QAAQ,CAAC,KAAK,CAAC,IAAI,CAAC,EAAE;AACxB,QAAA,gBAAgB,CAAC,KAAK,EAAE,SAAS,CAAC,CAAC;KACpC;SAAM;AACL,QAAA,cAAc,CAAC,KAAK,EAAE,SAAS,CAAC,CAAC;KAClC;AACH,CAAC;AAED;AACA,SAAS,gBAAgB,CAAC,KAAK,EAAE,SAAS,EAAA;;AAExC,IAAA,cAAc,CAAC,KAAK,EAAE,SAAS,CAAC,CAAC;AAInC,CAAC;AACD,SAAS,cAAc,CAAC,KAAU,EAAE,SAAS,EAAA;AAC3C,IAAA,MAAM,QAAQ,GAAG,uBAAuB,CAAC,KAAK,CAAC,CAAC;IAChD,cAAc,CAAC,QAAQ,CAAC,CAAC;AACzB,IAAA,kBAAkB,CAAC,QAAQ,EAAE,KAAK,EAAE,SAAS,CAAC,CAAC;AACjD,CAAC;AAED,SAAS,kBAAkB,CAAC,QAAQ,EAAE,KAAK,EAAE,SAAS,EAAA;AACpD,IAAA,MAAM,EAAE,KAAK,EAAE,GAAG,QAAQ,CAAC;;IAE3B,MAAM,OAAO,GAAG,QAAQ,CAAC,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;;;AAI5C,IAAA,KAAK,CAAC,OAAO,EAAE,SAAS,CAAC,CAAC;;AAG1B,IAAA,KAAK,CAAC,EAAE,GAAG,OAAO,CAAC,EAAE,CAAC;AACxB,CAAC;AAID;AACA,SAAS,cAAc,CAAC,KAAU,EAAE,SAAc,EAAA;AAChD,IAAA,YAAY,CAAC,KAAK,EAAE,SAAS,CAAC,CAAC;AACjC,CAAC;AACD,SAAS,YAAY,CAAC,KAAU,EAAE,SAAc,EAAA;IAC9C,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,QAAQ,EAAE,GAAG,KAAK,CAAC;;AAExC,IAAA,MAAM,OAAO,IAAI,KAAK,CAAC,EAAE,GAAG,QAAQ,CAAC,aAAa,CAAC,IAAI,CAAC,CAAC,CAAC;;IAG1D,IAAI,OAAO,QAAQ,IAAI,QAAQ;AAAE,QAAA,OAAO,CAAC,WAAW,GAAG,QAAQ,CAAC;AAC3D,SAAA,IAAI,KAAK,CAAC,OAAO,CAAC,QAAQ,CAAC,EAAE;AAChC,QAAA,aAAa,CAAC,KAAK,EAAE,OAAO,CAAC,CAAC;KAC/B;;AAGD,IAAA,KAAK,MAAM,GAAG,IAAI,KAAK,EAAE;AACvB,QAAA,MAAM,GAAG,GAAG,KAAK,CAAC,GAAG,CAAC,CAAC;AACvB,QAAA,OAAO,CAAC,YAAY,CAAC,GAAG,EAAE,GAAG,CAAC,CAAC;KAChC;AACD,IAAA,SAAS,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC;AAC5B,CAAC;AAED,SAAS,aAAa,CAAC,KAAU,EAAE,SAAc,EAAA;IAC/C,KAAK,CAAC,QAAQ,CAAC,OAAO,CAAC,CAAC,KAAK,KAAI;AAC/B,QAAA,KAAK,CAAC,KAAK,EAAE,SAAS,CAAC,CAAC;AAC1B,KAAC,CAAC,CAAC;AACL;;SC/EgB,WAAW,CAAC,IAAI,EAAE,KAAM,EAAE,QAAS,EAAA;IACjD,MAAM,KAAK,GAAG,EAAE,IAAI,EAAE,KAAK,EAAE,QAAQ,EAAE,CAAC;AAExC,IAAA,OAAO,KAAK,CAAC;AACf;;ACDM,SAAU,SAAS,CAAC,aAAa,EAAA;IACrC,OAAO;AACL,QAAA,KAAK,CAAC,aAAa,EAAA;;;;AAIjB,YAAA,MAAM,KAAK,GAAG,WAAW,CAAC,aAAa,CAAC,CAAC;;AAGzC,YAAA,MAAM,CAAC,KAAK,EAAE,aAAa,CAAC,CAAC;SAC9B;KACF,CAAC;AACJ;;ACdO,MAAM,CAAC,GAAG,CACf,IAAS,EACT,KAAA,GAAa,IAAI,EACjB,QAAgC,GAAA,EAAE,KAChC;IACF,OAAO,WAAW,CAAC,IAAI,EAAE,KAAK,EAAE,QAAQ,CAAC,CAAC;AAC5C;;;;;"}