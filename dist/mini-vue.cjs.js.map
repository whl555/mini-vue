{"version":3,"file":"mini-vue.cjs.js","sources":["../src/shared/index.ts","../src/runtime-core/src/component.ts","../src/runtime-core/src/render.ts","../src/runtime-core/src/vnode.ts","../src/runtime-core/src/createApp.ts","../src/runtime-core/src/h.ts"],"sourcesContent":["export const extend = Object.assign;\n\nexport const isObject = (val) => {\n  return val != null && typeof val == \"object\";\n};\n\nexport const isSame = (val, newVal) => {\n  return Object.is(val, newVal);\n};\n","export function createComponentInstance(vnode) {\n  const component = {\n    vnode,\n    type: vnode.type,\n  };\n\n  return component;\n}\n\nexport function setupComponent(instance) {\n  // TODO\n  // initProps()\n  // initSlots()\n\n  setupStatefulComponent(instance);\n}\n\n// instance添加状态(setupRes、render)\nfunction setupStatefulComponent(instance) {\n  // instance: {vnode, xxx} vnode: {type(编写的组件), props?, children}\n  const component = instance.type;\n  const { setup } = component;\n\n  if (setup) {\n    const setupRes = setup();\n    handleSetupRes(instance, setupRes);\n  }\n}\n\nfunction handleSetupRes(instance, setupRes: any) {\n  // 1. return 函数\n  // 2. return 值\n\n  if (typeof setupRes == \"object\") {\n    instance.setupRes = setupRes;\n  }\n  finishComponentSetup(instance);\n}\nfunction finishComponentSetup(instance) {\n  const component = instance.type;\n  if (component.render) {\n    instance.render = component.render;\n  }\n}\n","import { isObject } from \"../../shared\";\nimport { createComponentInstance, setupComponent } from \"./component\";\n\nexport function render(vnode, container) {\n  // invoke patch\n  patch(vnode, container);\n}\n\n/**\n * 递归处理虚拟节点树, 递归终点是Element\n * @param vnode 虚拟节点\n * @param container 根容器Element\n */\nfunction patch(vnode, container) {\n  debugger;\n  // check node type, assert to be component\n  if (isObject(vnode.type)) {\n    processComponent(vnode, container);\n  } else {\n    processElement(vnode, container);\n  }\n}\n\n// 处理component组件\nfunction processComponent(vnode, container) {\n  // init\n  mountComponent(vnode, container);\n\n  // update\n  updateComponent(vnode);\n}\nfunction mountComponent(vnode: any, container) {\n  const instance = createComponentInstance(vnode);\n  setupComponent(instance);\n  setupRenderEffects(instance, container);\n}\n\nfunction setupRenderEffects(instance, container) {\n  const subTree = instance.render();\n\n  // vnode -> element -> mount(element)\n  // 进入递归\n  patch(subTree, container);\n}\n\nfunction updateComponent(vnode: any) {}\n\n// 处理element节点\nfunction processElement(vnode: any, container: any) {\n  mountElement(vnode, container);\n}\nfunction mountElement(vnode: any, container: any) {\n  const { type, props, children } = vnode;\n  // 1. el\n  const el = document.createElement(type);\n\n  // 2. add children\n  if (typeof children == \"string\") el.textContent = children;\n  else if (Array.isArray(children)) {\n    mountChildren(vnode, el);\n  }\n\n  // 3. add props\n  for (const key in props) {\n    const val = props[key];\n    el.setAttribute(key, val);\n  }\n  container.append(el);\n}\n\nfunction mountChildren(vnode: any, container: any) {\n  vnode.children.forEach((child) => {\n    patch(child, container);\n  });\n}\n","export function createVNode(type, props?, children?) {\n  const vnode = { type, props, children };\n\n  return vnode;\n}\n","import { render } from \"./render\";\nimport { createVNode } from \"./vnode\";\n\nexport function createApp(rootComponent) {\n  return {\n    mount(rootContainer) {\n      // 1. component -> vnode\n      // 所有操作都是基于vnode\n      // vnode有component和element两种类型\n      const vnode = createVNode(rootComponent);\n\n      // 2. invoke render\n      render(vnode, rootContainer);\n    },\n  };\n}\n","import { createVNode } from \"./vnode\";\r\nexport const h = (\r\n  type: any,\r\n  props: any = null,\r\n  children: string | Array<any> = []\r\n) => {\r\n  return createVNode(type, props, children);\r\n};\r\n"],"names":[],"mappings":"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"}